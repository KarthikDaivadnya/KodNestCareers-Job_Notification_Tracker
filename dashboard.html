<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard â€” KodNest Careers</title>
  <link rel="stylesheet" href="/app.css" />
</head>
<body class="app-body">

  <!-- NAV -->
  <div id="nav-root"></div>

  <!-- PREFERENCES BANNER (shown when prefs not set) -->
  <div class="prefs-banner" id="prefs-banner" style="display:none;">
    <span class="prefs-banner-text">âš¡ Set your preferences to activate intelligent matching and see match scores on every job.</span>
    <a href="/settings" class="prefs-banner-link">Configure â†’</a>
  </div>

  <!-- FILTER BAR -->
  <div class="filter-bar">
    <div class="filter-bar-inner">

      <!-- Row 1: Dropdowns -->
      <div class="filter-row">
        <div class="filter-input-wrap">
          <svg class="filter-search-icon" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="6.5" cy="6.5" r="4.5" stroke="currentColor" stroke-width="1.5"/>
            <path d="M10 10l3.5 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <input class="filter-input" id="f-keyword" type="text"
            placeholder="Search by role or companyâ€¦" autocomplete="off" />
        </div>

        <select class="filter-select" id="f-location">
          <option value="">All Locations</option>
          <option value="Bangalore">Bangalore</option>
          <option value="Hyderabad">Hyderabad</option>
          <option value="Chennai">Chennai</option>
          <option value="Mumbai">Mumbai</option>
          <option value="Pune">Pune</option>
          <option value="Noida">Noida</option>
          <option value="Gurgaon">Gurgaon</option>
          <option value="Mysuru">Mysuru</option>
        </select>

        <select class="filter-select" id="f-mode">
          <option value="">All Modes</option>
          <option value="Remote">Remote</option>
          <option value="Hybrid">Hybrid</option>
          <option value="Onsite">Onsite</option>
        </select>

        <select class="filter-select" id="f-experience">
          <option value="">All Levels</option>
          <option value="Fresher">Fresher</option>
          <option value="0-1">0â€“1 yr</option>
          <option value="1-3">1â€“3 yrs</option>
          <option value="3-5">3â€“5 yrs</option>
        </select>

        <select class="filter-select" id="f-source">
          <option value="">All Sources</option>
          <option value="LinkedIn">LinkedIn</option>
          <option value="Naukri">Naukri</option>
          <option value="Indeed">Indeed</option>
        </select>

        <select class="filter-select" id="f-sort">
          <option value="latest">Latest First</option>
          <option value="score">Match Score â†“</option>
          <option value="salary">Salary â†“</option>
          <option value="oldest">Oldest First</option>
        </select>
      </div>

      <!-- Row 2: Count + toggle -->
      <div class="filter-meta">
        <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap;">
          <span class="filter-count" id="filter-count"><strong>60</strong> jobs found</span>
          <button class="filter-clear" id="filter-clear">Clear filters</button>
        </div>
        <div class="match-toggle-row" id="match-toggle-row" style="display:none;border-top:none;padding-top:0;">
          <label class="match-toggle-label" for="toggle-matches">
            <input type="checkbox" class="match-toggle-input" id="toggle-matches" />
            <span class="match-toggle-text">Show only jobs above my threshold</span>
          </label>
          <span class="match-threshold-note" id="threshold-note"></span>
        </div>
      </div>

    </div>
  </div>

  <!-- JOBS GRID -->
  <main>
    <div class="jobs-workspace">
      <div class="jobs-grid" id="jobs-grid"></div>
    </div>
  </main>

  <!-- JOB DETAIL MODAL -->
  <div class="modal-overlay" id="modal-overlay" hidden>
    <div class="modal-container" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal-header">
        <div class="modal-header-info">
          <div class="modal-title" id="modal-title"></div>
          <div class="modal-company" id="modal-company"></div>
        </div>
        <button class="modal-close" id="modal-close" aria-label="Close">âœ•</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
      <div class="modal-footer" id="modal-footer"></div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="/jobs.js"></script>
  <script src="/match-engine.js"></script>
  <script>
    var ME = window.MATCH_ENGINE;

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STATE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    var prefs = null;
    var scoredJobs = [];
    var currentFiltered = [];
    var filters = { keyword: '', location: '', mode: '', experience: '', source: '', sort: 'latest' };
    var onlyMatches = false;

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STORAGE HELPERS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    var LS_KEY = 'kn_saved_jobs';

    function getSavedIds() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch (e) { return []; }
    }
    function setSavedIds(ids) { localStorage.setItem(LS_KEY, JSON.stringify(ids)); }
    function isJobSaved(id)   { return getSavedIds().indexOf(id) !== -1; }

    function toggleSave(id) {
      var ids = getSavedIds(), idx = ids.indexOf(id);
      if (idx === -1) { ids.push(id); } else { ids.splice(idx, 1); }
      setSavedIds(ids);
      renderJobs(currentFiltered);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MATCH SCORE SETUP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function buildScoredJobs() {
      scoredJobs = window.JOBS.map(function (j) {
        return { job: j, score: ME.computeMatchScore(j, prefs) };
      });
    }

    function scoreOf(id) {
      for (var i = 0; i < scoredJobs.length; i++) {
        if (scoredJobs[i].job.id === id) return scoredJobs[i].score;
      }
      return 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DISPLAY HELPERS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function postedLabel(n) {
      if (n === 0) return 'Today';
      if (n === 1) return '1 day ago';
      return n + ' days ago';
    }

    function sourceBadge(source) {
      return '<span class="badge badge-' + source.toLowerCase() + '">' + source + '</span>';
    }

    function scoreBadgeHtml(score) {
      if (!prefs) return '';
      var tier = ME.scoreTier(score);
      return '<span class="score-badge score-' + tier + '">' + score + '%</span>';
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CARD RENDERER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function renderCard(entry) {
      var job = entry.job, score = entry.score;
      var saved = isJobSaved(job.id);
      var expLabel = job.experience === 'Fresher' ? 'Fresher' : job.experience + ' yr';

      return (
        '<div class="job-card">' +
          '<div class="job-card-top">' +
            '<div class="job-card-badges">' + sourceBadge(job.source) + scoreBadgeHtml(score) + '</div>' +
            '<span class="job-card-posted">' + postedLabel(job.postedDaysAgo) + '</span>' +
          '</div>' +
          '<div>' +
            '<div class="job-card-title">' + job.title + '</div>' +
            '<div class="job-card-company">' + job.company + '</div>' +
          '</div>' +
          '<div class="job-card-meta">' +
            '<span class="job-card-meta-item">ğŸ“ ' + job.location + '</span>' +
            '<span class="job-card-meta-item">' + job.mode + '</span>' +
            '<span class="job-card-meta-item">' + expLabel + '</span>' +
          '</div>' +
          '<div class="job-card-salary">â‚¹ ' + job.salaryRange + '</div>' +
          '<div class="job-card-actions">' +
            '<button class="btn-card btn-view" onclick="openModal(' + job.id + ')">View</button>' +
            '<button class="btn-card btn-save' + (saved ? ' is-saved' : '') + '" onclick="toggleSave(' + job.id + ')">' +
              (saved ? 'âœ“ Saved' : 'â˜† Save') + '</button>' +
            '<a class="btn-card btn-apply" href="' + job.applyUrl + '" target="_blank" rel="noopener noreferrer">Apply â†’</a>' +
          '</div>' +
        '</div>'
      );
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RENDER GRID
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function renderJobs(entries) {
      var grid = document.getElementById('jobs-grid');
      var countEl = document.getElementById('filter-count');
      if (!grid) return;

      if (entries.length === 0) {
        var isToggled = onlyMatches && prefs;
        grid.innerHTML =
          '<div class="no-results">' +
            '<div class="no-results-title">' + (isToggled ? 'No roles match your criteria.' : 'No jobs match your filters.') + '</div>' +
            '<p class="no-results-desc">' + (isToggled
              ? 'Try adjusting your filters, lowering your threshold in Settings, or clearing the match toggle.'
              : 'Try broadening your search or clearing some filters.') + '</p>' +
          '</div>';
      } else {
        grid.innerHTML = entries.map(renderCard).join('');
      }

      if (countEl) {
        var n = entries.length;
        countEl.innerHTML = '<strong>' + n + '</strong> job' + (n !== 1 ? 's' : '') + ' found';
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FILTER + SORT LOGIC
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function applyFilters() {
      var kw = filters.keyword.toLowerCase();

      var result = scoredJobs.filter(function (e) {
        var j = e.job;
        if (kw && j.title.toLowerCase().indexOf(kw) === -1 && j.company.toLowerCase().indexOf(kw) === -1) return false;
        if (filters.location   && j.location   !== filters.location)   return false;
        if (filters.mode       && j.mode       !== filters.mode)       return false;
        if (filters.experience && j.experience !== filters.experience) return false;
        if (filters.source     && j.source     !== filters.source)     return false;
        if (onlyMatches && prefs) {
          var threshold = prefs.minMatchScore !== undefined ? prefs.minMatchScore : 40;
          if (e.score < threshold) return false;
        }
        return true;
      });

      /* Sort */
      result.sort(function (a, b) {
        if (filters.sort === 'score')  return b.score - a.score;
        if (filters.sort === 'salary') return ME.extractSalaryNum(b.job.salaryRange) - ME.extractSalaryNum(a.job.salaryRange);
        if (filters.sort === 'oldest') return b.job.postedDaysAgo - a.job.postedDaysAgo;
        return a.job.postedDaysAgo - b.job.postedDaysAgo; /* latest */
      });

      currentFiltered = result;

      /* Show/hide clear button */
      var hasFilter = kw || filters.location || filters.mode || filters.experience || filters.source;
      var clearBtn = document.getElementById('filter-clear');
      if (clearBtn) clearBtn.classList.toggle('is-visible', !!hasFilter);

      renderJobs(result);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EVENT LISTENERS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function bindFilters() {
      document.getElementById('f-keyword').addEventListener('input', function () {
        filters.keyword = this.value; applyFilters();
      });
      document.getElementById('f-location').addEventListener('change', function () {
        filters.location = this.value; applyFilters();
      });
      document.getElementById('f-mode').addEventListener('change', function () {
        filters.mode = this.value; applyFilters();
      });
      document.getElementById('f-experience').addEventListener('change', function () {
        filters.experience = this.value; applyFilters();
      });
      document.getElementById('f-source').addEventListener('change', function () {
        filters.source = this.value; applyFilters();
      });
      document.getElementById('f-sort').addEventListener('change', function () {
        filters.sort = this.value; applyFilters();
      });
      document.getElementById('filter-clear').addEventListener('click', function () {
        filters = { keyword: '', location: '', mode: '', experience: '', source: '', sort: filters.sort };
        document.getElementById('f-keyword').value    = '';
        document.getElementById('f-location').value  = '';
        document.getElementById('f-mode').value       = '';
        document.getElementById('f-experience').value = '';
        document.getElementById('f-source').value     = '';
        this.classList.remove('is-visible');
        applyFilters();
      });
      document.getElementById('toggle-matches').addEventListener('change', function () {
        onlyMatches = this.checked; applyFilters();
      });
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function openModal(id) {
      var entry = null;
      for (var i = 0; i < scoredJobs.length; i++) {
        if (scoredJobs[i].job.id === id) { entry = scoredJobs[i]; break; }
      }
      if (!entry) return;
      var job = entry.job, score = entry.score;

      document.getElementById('modal-title').textContent = job.title;
      document.getElementById('modal-company').textContent = job.company + ' Â· ' + job.location;

      var scoreLine = prefs ? ('<span class="score-badge score-' + ME.scoreTier(score) + '" style="font-size:11px;">' + score + '% match</span>') : '';

      document.getElementById('modal-body').innerHTML =
        '<div class="modal-meta-row">' +
          sourceBadge(job.source) + scoreLine +
          '<span class="modal-meta-chip">' + job.mode + '</span>' +
          '<span class="modal-meta-chip">' + (job.experience === 'Fresher' ? 'Fresher' : job.experience + ' yr') + '</span>' +
          '<span class="modal-meta-chip">' + postedLabel(job.postedDaysAgo) + '</span>' +
        '</div>' +
        '<div class="modal-salary">â‚¹ ' + job.salaryRange + '</div>' +
        '<div>' +
          '<div class="modal-section-label">About this role</div>' +
          '<p class="modal-description">' + job.description + '</p>' +
        '</div>' +
        '<div>' +
          '<div class="modal-section-label">Skills required</div>' +
          '<div class="modal-skills">' +
            job.skills.map(function (s) { return '<span class="modal-skill-chip">' + s + '</span>'; }).join('') +
          '</div>' +
        '</div>';

      document.getElementById('modal-footer').innerHTML =
        '<span class="modal-footer-note">Opens on ' + job.source + '.</span>' +
        '<a class="btn-modal-apply" href="' + job.applyUrl + '" target="_blank" rel="noopener noreferrer">Apply on ' + job.source + ' â†’</a>';

      document.getElementById('modal-overlay').removeAttribute('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      document.getElementById('modal-overlay').setAttribute('hidden', '');
      document.body.style.overflow = '';
    }

    function bindModal() {
      document.getElementById('modal-close').addEventListener('click', closeModal);
      document.getElementById('modal-overlay').addEventListener('click', function (e) {
        if (e.target === this) closeModal();
      });
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') closeModal();
      });
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INIT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    document.addEventListener('DOMContentLoaded', function () {
      prefs = ME.getPreferences();

      /* Banner: show if no prefs */
      var banner = document.getElementById('prefs-banner');
      if (!prefs) {
        banner.style.display = 'flex';
      }

      /* Match toggle: show only if prefs exist */
      var toggleRow = document.getElementById('match-toggle-row');
      if (prefs) {
        toggleRow.style.display = 'flex';
        var threshold = prefs.minMatchScore !== undefined ? prefs.minMatchScore : 40;
        document.getElementById('threshold-note').textContent = 'Score â‰¥ ' + threshold;
      }

      buildScoredJobs();
      bindFilters();
      bindModal();
      applyFilters();
    });
  </script>

  <script src="/app-nav.js"></script>
</body>
</html>
